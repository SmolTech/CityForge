---
# Cloudflare Tunnel Configuration
tunnel: {{ tunnel_uuid }}
credentials-file: {{ tunnel_credentials_file }}

# Logging configuration
loglevel: {{ cloudflared_log_level }}
{% if cloudflared_log_file is defined %}
logfile: {{ cloudflared_log_file }}
{% endif %}

# Metrics and monitoring
{% if cloudflared_metrics_port is defined %}
metrics: 0.0.0.0:{{ cloudflared_metrics_port }}
{% endif %}

# Tunnel options
{% if tunnel_options is defined %}
{% if tunnel_options.grace_period is defined %}
grace-period: {{ tunnel_options.grace_period }}
{% endif %}
{% if tunnel_options.protocol is defined %}
protocol: {{ tunnel_options.protocol }}
{% endif %}
{% if tunnel_options.retries is defined %}
retries: {{ tunnel_options.retries }}
{% endif %}
{% if tunnel_options.heartbeat_interval is defined %}
heartbeat-interval: {{ tunnel_options.heartbeat_interval }}
{% endif %}
{% if tunnel_options.max_heartbeats is defined %}
max-heartbeats: {{ tunnel_options.max_heartbeats }}
{% endif %}
{% if cloudflared_no_autoupdate is defined and cloudflared_no_autoupdate %}
no-autoupdate: true
{% endif %}
{% endif %}

# Ingress rules
ingress:
{% for rule in tunnel_ingress %}
  - {% if rule.hostname is defined %}hostname: {{ rule.hostname }}{% endif %}

    {% if rule.path is defined %}path: {{ rule.path }}{% endif %}

    service: {{ rule.service }}
    {% if rule.originRequest is defined %}
    originRequest:
      {% for key, value in rule.originRequest.items() %}
      {{ key }}: {{ value }}
      {% endfor %}
    {% endif %}
{% endfor %}

# warp-routing (optional)
{% if warp_routing is defined and warp_routing.enabled %}
warp-routing:
  enabled: true
{% endif %}