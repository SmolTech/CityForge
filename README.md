# CityForge

## warning

Most of my technical knowledge is around the infrastucture for running
this. I'm not much of a web developer, and most of the web code was
generated by using Claude Code.

I have implemented some automation around security scanning of the code,
so I'm somewhat confident that there aren't any glaring security issues.

That being said, I'm happy to hear feedback from experts, and I'd love
to find some people who want to collaborate on the project.

## Running locally with Docker

- Install Docker and compose.
- docker-compose up --build
- docker exec -it cityforge-backend python init_db.py
- In web browser, go to "http://localhost"

## Tech Stack

- **Frontend**: Next.js 15 with TypeScript
- **Styling**: Tailwind CSS
- **Code Quality**: ESLint + Prettier + Semgrep with git hooks
- **Security**: Semgrep static analysis for vulnerability detection
- **Containerization**: Docker with multi-stage builds
- **Node Version**: 20 LTS

#### Setup Node

```bash
# Install dependencies
npm install

# Set up pre-commit script
npm run prepare
```

#### Setup Python

```bash
python -m venv .venv
.venv/bin/python -m pip install -r backend/requirements.txt
.venv/bin/python -m pip install -r backend/requirements-dev.txt
.venv/bin/python -m pip install -r backend/requirements-test.txt
```

#### Developing With Docker

```bash
docker-compose up --build
```

--build can be excluded to use previous container build

To run the services in the backgroup, run:

```bash
docker-compose up --build -d
```

##### Initial database initialization for the first time

```bash
docker exec -it cityforge-backend python init_db.py
```

#### Useful NPM commands

```bash
# Run development server
npm run dev

# Build for production
npm run build

# Start production server
npm start

# Run linting
npm run lint

# Format code
npm run format

# Type checking
npm run typecheck

# Security analysis
npm run semgrep
```

````

## Security Analysis

The project includes Semgrep for automated security vulnerability detection:

```bash
# Run security analysis
npm run semgrep

# Run security analysis (CI mode - quiet output)
npm run semgrep:ci
```

## Git Hooks

This project includes git hooks for code quality and security:

- **Pre-commit**: Runs lint-staged (ESLint + Prettier) and semgrep security analysis
- **Pre-push**: Runs type checking, linting, semgrep, and build verification

## Project Structure

```
├── src/                   # Frontend application
│   ├── app/               # Next.js app router pages
│   │   ├── admin/         # Admin dashboard
│   │   ├── api/           # API route handlers
│   │   ├── business/      # Business directory pages
│   │   ├── dashboard/     # User dashboard
│   │   ├── login/         # Login page
│   │   ├── register/      # Registration page
│   │   ├── resources/     # Resource directory pages
│   │   ├── search/        # Search interface
│   │   ├── settings/      # User settings
│   │   ├── submit/        # Business card submission
│   │   └── page.tsx       # Homepage
│   ├── components/        # React components
│   └── lib/               # Utilities and API client
├── backend/               # Flask API backend
│   ├── app/               # Application modules
│   │   ├── models.py      # Database models
│   │   ├── routes/        # API endpoints
│   │   └── utils/         # Helper functions
│   ├── tests/             # Backend tests
│   ├── uploads/           # Uploaded files
│   ├── app.py             # Flask application
│   ├── init_db.py         # Database initialization
│   └── requirements.txt   # Python dependencies
├── indexer/               # OpenSearch indexing service
│   ├── indexer.py         # Website crawler and indexer
│   └── requirements.txt   # Python dependencies
├── .github/
│   └── workflows/         # GitHub Actions CI/CD
├── .husky/                # Git hooks
├── public/                # Static assets
├── scripts/               # Build and deployment scripts
├── templates/             # Email templates
├── Dockerfile             # Frontend container
└── README.md              # Project documentation
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests and linting
5. Submit a pull request

## License

GPLv3 License - see LICENSE file for details
