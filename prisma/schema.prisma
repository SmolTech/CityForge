generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                        Int                    @id @default(autoincrement())
  email                     String                 @unique @db.VarChar(120)
  passwordHash              String                 @map("password_hash") @db.VarChar(128)
  firstName                 String                 @map("first_name") @db.VarChar(50)
  lastName                  String                 @map("last_name") @db.VarChar(50)
  role                      UserRole               @default(user)
  isSupporterFlag           Boolean                @default(false) @map("is_supporter_flag")
  isActive                  Boolean                @default(true) @map("is_active")
  createdDate               DateTime               @default(now()) @map("created_date")
  lastLogin                 DateTime?              @map("last_login")
  reviewedModifications     CardModification[]     @relation("ModificationReviewer")
  cardModifications         CardModification[]     @relation("ModificationCreator")
  reviewedSubmissions       CardSubmission[]       @relation("SubmissionReviewer")
  cardSubmissions           CardSubmission[]       @relation("SubmissionCreator")
  approvedCards             Card[]                 @relation("CardApprover")
  createdCards              Card[]                 @relation("CardCreator")
  forumCategories           ForumCategory[]
  categoryRequests          ForumCategoryRequest[] @relation("CategoryRequester")
  reviewedCategoryRequests  ForumCategoryRequest[] @relation("CategoryReviewer")
  forumPosts                ForumPost[]            @relation("PostCreator")
  editedForumPosts          ForumPost[]            @relation("PostEditor")
  forumReports              ForumReport[]          @relation("ForumReporter")
  reviewedForumReports      ForumReport[]          @relation("ForumReviewedBy")
  forumThreads              ForumThread[]
  helpWantedComments        HelpWantedComment[]
  helpWantedPosts           HelpWantedPost[]
  helpWantedReports         HelpWantedReport[]     @relation("HelpWantedReporter")
  reviewedHelpWantedReports HelpWantedReport[]     @relation("HelpWantedReviewer")
  reportedReviews           Review[]               @relation("ReviewReporter")
  reviews                   Review[]               @relation("ReviewCreator")
  supportTicketMessages     SupportTicketMessage[]
  assignedTickets           SupportTicket[]        @relation("TicketAssignee")
  supportTickets            SupportTicket[]        @relation("TicketCreator")
  revokedTokens             TokenBlacklist[]

  @@index([email])
  @@map("users")
}

model Tag {
  id          Int      @id @default(autoincrement())
  name        String   @unique @db.VarChar(500)
  createdDate DateTime @default(now()) @map("created_date")
  cards       Card[]   @relation("CardToTag")

  @@index([name])
  @@map("tags")
}

model Card {
  id                 Int                @id @default(autoincrement())
  name               String             @db.VarChar(255)
  description        String?
  websiteUrl         String?            @map("website_url") @db.VarChar(255)
  phoneNumber        String?            @map("phone_number") @db.VarChar(20)
  email              String?            @db.VarChar(100)
  address            String?            @db.VarChar(255)
  addressOverrideUrl String?            @map("address_override_url") @db.VarChar(500)
  contactName        String?            @map("contact_name") @db.VarChar(100)
  featured           Boolean            @default(false)
  imageUrl           String?            @map("image_url") @db.VarChar(255)
  createdBy          Int?               @map("created_by")
  approved           Boolean            @default(true)
  approvedBy         Int?               @map("approved_by")
  approvedDate       DateTime?          @map("approved_date")
  createdDate        DateTime           @default(now()) @map("created_date")
  updatedDate        DateTime           @default(now()) @updatedAt @map("updated_date")
  modifications      CardModification[]
  submissions        CardSubmission[]
  approver           User?              @relation("CardApprover", fields: [approvedBy], references: [id])
  creator            User?              @relation("CardCreator", fields: [createdBy], references: [id])
  reviews            Review[]
  tags               Tag[]              @relation("CardToTag")

  @@index([name])
  @@map("cards")
}

model CardSubmission {
  id                 Int              @id @default(autoincrement())
  name               String           @db.VarChar(255)
  description        String?
  websiteUrl         String?          @map("website_url") @db.VarChar(255)
  phoneNumber        String?          @map("phone_number") @db.VarChar(20)
  email              String?          @db.VarChar(100)
  address            String?          @db.VarChar(255)
  addressOverrideUrl String?          @map("address_override_url") @db.VarChar(500)
  contactName        String?          @map("contact_name") @db.VarChar(100)
  imageUrl           String?          @map("image_url") @db.VarChar(255)
  tagsText           String?          @map("tags_text")
  status             SubmissionStatus @default(pending)
  submittedBy        Int              @map("submitted_by")
  reviewedBy         Int?             @map("reviewed_by")
  reviewNotes        String?          @map("review_notes")
  cardId             Int?             @map("card_id")
  createdDate        DateTime         @default(now()) @map("created_date")
  reviewedDate       DateTime?        @map("reviewed_date")
  card               Card?            @relation(fields: [cardId], references: [id])
  reviewer           User?            @relation("SubmissionReviewer", fields: [reviewedBy], references: [id])
  submitter          User             @relation("SubmissionCreator", fields: [submittedBy], references: [id])

  @@map("card_submissions")
}

model CardModification {
  id                 Int              @id @default(autoincrement())
  cardId             Int              @map("card_id")
  name               String           @db.VarChar(255)
  description        String?
  websiteUrl         String?          @map("website_url") @db.VarChar(255)
  phoneNumber        String?          @map("phone_number") @db.VarChar(20)
  email              String?          @db.VarChar(100)
  address            String?          @db.VarChar(255)
  addressOverrideUrl String?          @map("address_override_url") @db.VarChar(500)
  contactName        String?          @map("contact_name") @db.VarChar(100)
  imageUrl           String?          @map("image_url") @db.VarChar(255)
  tagsText           String?          @map("tags_text")
  status             SubmissionStatus @default(pending)
  submittedBy        Int              @map("submitted_by")
  reviewedBy         Int?             @map("reviewed_by")
  reviewNotes        String?          @map("review_notes")
  createdDate        DateTime         @default(now()) @map("created_date")
  reviewedDate       DateTime?        @map("reviewed_date")
  card               Card             @relation(fields: [cardId], references: [id])
  reviewer           User?            @relation("ModificationReviewer", fields: [reviewedBy], references: [id])
  submitter          User             @relation("ModificationCreator", fields: [submittedBy], references: [id])

  @@map("card_modifications")
}

model ResourceCategory {
  id            Int            @id @default(autoincrement())
  name          String         @unique @db.VarChar(100)
  displayOrder  Int            @default(0) @map("display_order")
  createdDate   DateTime       @default(now()) @map("created_date")
  resourceItems ResourceItem[]

  @@index([name])
  @@map("resource_categories")
}

model QuickAccessItem {
  id           Int      @id @default(autoincrement())
  identifier   String   @unique @db.VarChar(50)
  title        String   @db.VarChar(100)
  subtitle     String   @db.VarChar(100)
  phone        String   @db.VarChar(20)
  color        String   @default("blue") @db.VarChar(20)
  icon         String   @default("building") @db.VarChar(50)
  displayOrder Int      @default(0) @map("display_order")
  isActive     Boolean  @default(true) @map("is_active")
  createdDate  DateTime @default(now()) @map("created_date")

  @@index([identifier])
  @@map("quick_access_items")
}

model ResourceItem {
  id           Int               @id @default(autoincrement())
  title        String            @db.VarChar(200)
  url          String            @db.VarChar(500)
  description  String
  category     String            @db.VarChar(100)
  categoryId   Int?              @map("category_id")
  phone        String?           @db.VarChar(20)
  address      String?           @db.VarChar(500)
  icon         String            @default("building") @db.VarChar(50)
  displayOrder Int               @default(0) @map("display_order")
  isActive     Boolean           @default(true) @map("is_active")
  createdDate  DateTime          @default(now()) @map("created_date")
  updatedDate  DateTime          @default(now()) @updatedAt @map("updated_date")
  categoryObj  ResourceCategory? @relation(fields: [categoryId], references: [id])

  @@index([title])
  @@index([category])
  @@map("resource_items")
}

model ResourceConfig {
  id          Int      @id @default(autoincrement())
  key         String   @unique @db.VarChar(100)
  value       String
  description String?  @db.VarChar(500)
  createdDate DateTime @default(now()) @map("created_date")
  updatedDate DateTime @default(now()) @updatedAt @map("updated_date")

  @@index([key])
  @@map("resource_config")
}

model Review {
  id             Int       @id @default(autoincrement())
  cardId         Int       @map("card_id")
  userId         Int       @map("user_id")
  rating         Int
  title          String?   @db.VarChar(200)
  comment        String?
  reported       Boolean   @default(false)
  reportedBy     Int?      @map("reported_by")
  reportedDate   DateTime? @map("reported_date")
  reportedReason String?   @map("reported_reason")
  hidden         Boolean   @default(false)
  createdDate    DateTime  @default(now()) @map("created_date")
  updatedDate    DateTime  @default(now()) @updatedAt @map("updated_date")
  card           Card      @relation(fields: [cardId], references: [id])
  reporter       User?     @relation("ReviewReporter", fields: [reportedBy], references: [id])
  user           User      @relation("ReviewCreator", fields: [userId], references: [id])

  @@index([cardId])
  @@index([userId])
  @@index([reported])
  @@index([hidden])
  @@index([createdDate])
  @@map("reviews")
}

model ForumCategory {
  id               Int                    @id @default(autoincrement())
  name             String                 @unique @db.VarChar(100)
  description      String?
  slug             String                 @unique @db.VarChar(120)
  displayOrder     Int                    @default(0) @map("display_order")
  isActive         Boolean                @default(true) @map("is_active")
  createdBy        Int                    @map("created_by")
  createdDate      DateTime               @default(now()) @map("created_date")
  updatedDate      DateTime               @default(now()) @updatedAt @map("updated_date")
  creator          User                   @relation(fields: [createdBy], references: [id])
  categoryRequests ForumCategoryRequest[]
  threads          ForumThread[]

  @@index([name])
  @@index([slug])
  @@map("forum_categories")
}

model ForumCategoryRequest {
  id            Int              @id @default(autoincrement())
  name          String           @db.VarChar(100)
  description   String?
  justification String?
  status        SubmissionStatus @default(pending)
  requestedBy   Int              @map("requested_by")
  reviewedBy    Int?             @map("reviewed_by")
  createdDate   DateTime         @default(now()) @map("created_date")
  reviewedDate  DateTime?        @map("reviewed_date")
  reviewNotes   String?          @map("review_notes")
  categoryId    Int?             @map("category_id")
  category      ForumCategory?   @relation(fields: [categoryId], references: [id])
  requester     User             @relation("CategoryRequester", fields: [requestedBy], references: [id])
  reviewer      User?            @relation("CategoryReviewer", fields: [reviewedBy], references: [id])

  @@index([status])
  @@map("forum_category_requests")
}

model ForumThread {
  id          Int           @id @default(autoincrement())
  categoryId  Int           @map("category_id")
  title       String        @db.VarChar(255)
  slug        String        @db.VarChar(280)
  isPinned    Boolean       @default(false) @map("is_pinned")
  isLocked    Boolean       @default(false) @map("is_locked")
  reportCount Int           @default(0) @map("report_count")
  createdBy   Int           @map("created_by")
  createdDate DateTime      @default(now()) @map("created_date")
  updatedDate DateTime      @default(now()) @updatedAt @map("updated_date")
  posts       ForumPost[]
  reports     ForumReport[]
  category    ForumCategory @relation(fields: [categoryId], references: [id])
  creator     User          @relation(fields: [createdBy], references: [id])

  @@index([title])
  @@index([slug])
  @@index([createdDate])
  @@index([updatedDate])
  @@map("forum_threads")
}

model ForumPost {
  id          Int           @id @default(autoincrement())
  threadId    Int           @map("thread_id")
  content     String
  isFirstPost Boolean       @default(false) @map("is_first_post")
  reportCount Int           @default(0) @map("report_count")
  createdBy   Int           @map("created_by")
  createdDate DateTime      @default(now()) @map("created_date")
  updatedDate DateTime      @default(now()) @updatedAt @map("updated_date")
  editedBy    Int?          @map("edited_by")
  editedDate  DateTime?     @map("edited_date")
  creator     User          @relation("PostCreator", fields: [createdBy], references: [id])
  editor      User?         @relation("PostEditor", fields: [editedBy], references: [id])
  thread      ForumThread   @relation(fields: [threadId], references: [id], onDelete: Cascade)
  reports     ForumReport[]

  @@map("forum_posts")
}

model ForumReport {
  id              Int               @id @default(autoincrement())
  threadId        Int               @map("thread_id")
  postId          Int?              @map("post_id")
  reason          ForumReportReason
  details         String?
  status          SubmissionStatus  @default(pending)
  reportedBy      Int               @map("reported_by")
  reviewedBy      Int?              @map("reviewed_by")
  createdDate     DateTime          @default(now()) @map("created_date")
  reviewedDate    DateTime?         @map("reviewed_date")
  resolutionNotes String?           @map("resolution_notes")
  post            ForumPost?        @relation(fields: [postId], references: [id], onDelete: Cascade)
  reporter        User              @relation("ForumReporter", fields: [reportedBy], references: [id])
  reviewer        User?             @relation("ForumReviewedBy", fields: [reviewedBy], references: [id])
  thread          ForumThread       @relation(fields: [threadId], references: [id], onDelete: Cascade)

  @@map("forum_reports")
}

model HelpWantedPost {
  id                Int                 @id @default(autoincrement())
  title             String              @db.VarChar(255)
  description       String
  category          HelpWantedCategory
  status            HelpWantedStatus    @default(open)
  location          String?             @db.VarChar(255)
  budget            String?             @db.VarChar(100)
  contactPreference String              @default("message") @map("contact_preference") @db.VarChar(50)
  reportCount       Int                 @default(0) @map("report_count")
  createdBy         Int                 @map("created_by")
  createdDate       DateTime            @default(now()) @map("created_date")
  updatedDate       DateTime            @default(now()) @updatedAt @map("updated_date")
  comments          HelpWantedComment[]
  creator           User                @relation(fields: [createdBy], references: [id])
  reports           HelpWantedReport[]

  @@index([title])
  @@index([category])
  @@index([status])
  @@index([createdDate])
  @@map("help_wanted_posts")
}

model HelpWantedComment {
  id          Int                 @id @default(autoincrement())
  postId      Int                 @map("post_id")
  content     String
  parentId    Int?                @map("parent_id")
  createdBy   Int                 @map("created_by")
  createdDate DateTime            @default(now()) @map("created_date")
  updatedDate DateTime            @default(now()) @updatedAt @map("updated_date")
  creator     User                @relation(fields: [createdBy], references: [id])
  parent      HelpWantedComment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies     HelpWantedComment[] @relation("CommentReplies")
  post        HelpWantedPost      @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("help_wanted_comments")
}

model HelpWantedReport {
  id              Int                @id @default(autoincrement())
  postId          Int                @map("post_id")
  reason          ReviewReportReason
  details         String?
  status          SubmissionStatus   @default(pending)
  reportedBy      Int                @map("reported_by")
  reviewedBy      Int?               @map("reviewed_by")
  createdDate     DateTime           @default(now()) @map("created_date")
  reviewedDate    DateTime?          @map("reviewed_date")
  resolutionNotes String?            @map("resolution_notes")
  post            HelpWantedPost     @relation(fields: [postId], references: [id], onDelete: Cascade)
  reporter        User               @relation("HelpWantedReporter", fields: [reportedBy], references: [id])
  reviewer        User?              @relation("HelpWantedReviewer", fields: [reviewedBy], references: [id])

  @@map("help_wanted_reports")
}

model SupportTicket {
  id                Int                    @id @default(autoincrement())
  title             String                 @db.VarChar(255)
  description       String
  category          SupportTicketCategory
  status            SupportTicketStatus    @default(open)
  priority          SupportTicketPriority  @default(normal)
  isAnonymous       Boolean                @default(false) @map("is_anonymous")
  createdBy         Int                    @map("created_by")
  assignedTo        Int?                   @map("assigned_to")
  createdDate       DateTime               @default(now()) @map("created_date")
  updatedDate       DateTime               @default(now()) @updatedAt @map("updated_date")
  resolvedDate      DateTime?              @map("resolved_date")
  closedDate        DateTime?              @map("closed_date")
  messages          SupportTicketMessage[]
  assignedSupporter User?                  @relation("TicketAssignee", fields: [assignedTo], references: [id])
  creator           User                   @relation("TicketCreator", fields: [createdBy], references: [id])

  @@index([title])
  @@index([category])
  @@index([status])
  @@index([createdDate])
  @@map("support_tickets")
}

model SupportTicketMessage {
  id             Int           @id @default(autoincrement())
  ticketId       Int           @map("ticket_id")
  content        String
  isInternalNote Boolean       @default(false) @map("is_internal_note")
  createdBy      Int           @map("created_by")
  createdDate    DateTime      @default(now()) @map("created_date")
  updatedDate    DateTime      @default(now()) @updatedAt @map("updated_date")
  creator        User          @relation(fields: [createdBy], references: [id])
  ticket         SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@map("support_ticket_messages")
}

model IndexingJob {
  id           Int               @id @default(autoincrement())
  resourceId   Int               @map("resource_id")
  status       IndexingJobStatus @default(pending)
  pagesIndexed Int               @default(0) @map("pages_indexed")
  totalPages   Int               @default(0) @map("total_pages")
  lastError    String?           @map("last_error")
  startedAt    DateTime?         @map("started_at") @db.Timestamptz(6)
  completedAt  DateTime?         @map("completed_at") @db.Timestamptz(6)
  retryCount   Int               @default(0) @map("retry_count")
  createdDate  DateTime          @default(now()) @map("created_date") @db.Timestamptz(6)
  updatedDate  DateTime?         @updatedAt @map("updated_date") @db.Timestamptz(6)

  @@index([resourceId])
  @@index([status])
  @@map("indexing_jobs")
}

model TokenBlacklist {
  id        Int      @id @default(autoincrement())
  jti       String   @unique @db.VarChar(36)
  tokenType String   @map("token_type") @db.VarChar(10)
  userId    Int?     @map("user_id")
  revokedAt DateTime @default(now()) @map("revoked_at")
  expiresAt DateTime @map("expires_at")
  user      User?    @relation(fields: [userId], references: [id])

  @@index([jti])
  @@map("token_blacklist")
}

enum UserRole {
  admin
  supporter
  user
}

enum SubmissionStatus {
  pending
  approved
  rejected
}

enum SupportTicketStatus {
  open
  in_progress
  resolved
  closed
}

enum SupportTicketPriority {
  low
  normal
  high
  urgent
}

enum SupportTicketCategory {
  housing
  food
  transportation
  healthcare
  financial
  other
}

enum HelpWantedCategory {
  hiring
  collaboration
  general
}

enum HelpWantedStatus {
  open
  closed
}

enum ForumReportReason {
  spam
  inappropriate
  harassment
  off_topic
  other
}

enum IndexingJobStatus {
  pending
  in_progress
  completed
  failed
}

enum ReviewReportReason {
  spam
  inappropriate
  misleading
  other
}
