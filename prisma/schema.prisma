generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                        Int                    @id @default(autoincrement())
  email                     String                 @unique(map: "ix_users_email") @db.VarChar(120)
  passwordHash              String                 @map("password_hash") @db.VarChar(128)
  firstName                 String                 @map("first_name") @db.VarChar(50)
  lastName                  String                 @map("last_name") @db.VarChar(50)
  role                      String                 @db.VarChar(20)
  isActive                  Boolean?               @map("is_active")
  createdDate               DateTime?              @map("created_date") @db.Timestamp(6)
  lastLogin                 DateTime?              @map("last_login") @db.Timestamp(6)
  isSupporterFlag           Boolean                @default(false) @map("is_supporter_flag")
  emailVerified             Boolean?               @default(false) @map("email_verified")
  emailVerificationToken    String?                @map("email_verification_token") @db.VarChar(255)
  emailVerificationSentAt   DateTime?              @map("email_verification_sent_at") @db.Timestamp(6)
  reviewedModifications     CardModification[]     @relation("ModificationReviewer")
  cardModifications         CardModification[]     @relation("ModificationCreator")
  reviewedSubmissions       CardSubmission[]       @relation("SubmissionReviewer")
  cardSubmissions           CardSubmission[]       @relation("SubmissionCreator")
  approvedCards             Card[]                 @relation("CardApprover")
  createdCards              Card[]                 @relation("CardCreator")
  forumCategories           ForumCategory[]
  categoryRequests          ForumCategoryRequest[] @relation("CategoryRequester")
  reviewedCategoryRequests  ForumCategoryRequest[] @relation("CategoryReviewer")
  forumPosts                ForumPost[]            @relation("PostCreator")
  editedForumPosts          ForumPost[]            @relation("PostEditor")
  forumReports              ForumReport[]          @relation("ForumReporter")
  reviewedForumReports      ForumReport[]          @relation("ForumReviewedBy")
  forumThreads              ForumThread[]
  helpWantedComments        HelpWantedComment[]
  helpWantedPosts           HelpWantedPost[]
  helpWantedReports         HelpWantedReport[]     @relation("HelpWantedReporter")
  reviewedHelpWantedReports HelpWantedReport[]     @relation("HelpWantedReviewer")
  reportedReviews           Review[]               @relation("ReviewReporter")
  reviews                   Review[]               @relation("ReviewCreator")
  supportTicketMessages     SupportTicketMessage[]
  assignedTickets           SupportTicket[]        @relation("TicketAssignee")
  supportTickets            SupportTicket[]        @relation("TicketCreator")
  revokedTokens             TokenBlacklist[]
  passwordResetTokens       PasswordResetToken[]

  @@map("users")
}

model Tag {
  id          Int         @id @default(autoincrement())
  name        String      @unique(map: "ix_tags_name") @db.VarChar(500)
  createdDate DateTime?   @map("created_date") @db.Timestamp(6)
  card_tags   card_tags[]

  @@map("tags")
}

model Card {
  id                 Int                @id @default(autoincrement())
  name               String             @db.VarChar(255)
  description        String?
  websiteUrl         String?            @map("website_url") @db.VarChar(255)
  phoneNumber        String?            @map("phone_number") @db.VarChar(20)
  email              String?            @db.VarChar(100)
  address            String?            @db.VarChar(255)
  addressOverrideUrl String?            @map("address_override_url") @db.VarChar(500)
  contactName        String?            @map("contact_name") @db.VarChar(100)
  featured           Boolean?
  imageUrl           String?            @map("image_url") @db.VarChar(255)
  createdBy          Int?               @map("created_by")
  approved           Boolean?
  approvedBy         Int?               @map("approved_by")
  approvedDate       DateTime?          @map("approved_date") @db.Timestamp(6)
  createdDate        DateTime?          @map("created_date") @db.Timestamp(6)
  updatedDate        DateTime?          @updatedAt @map("updated_date") @db.Timestamp(6)
  modifications      CardModification[]
  submissions        CardSubmission[]
  card_tags          card_tags[]
  approver           User?              @relation("CardApprover", fields: [approvedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  creator            User?              @relation("CardCreator", fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviews            Review[]

  @@index([name], map: "ix_cards_name")
  @@index([approved], map: "ix_cards_approved")
  @@index([createdDate], map: "ix_cards_created_date")
  @@index([approved, createdDate], map: "ix_cards_approved_created_date")
  @@map("cards")
}

model CardSubmission {
  id                 Int       @id @default(autoincrement())
  name               String    @db.VarChar(255)
  description        String?
  websiteUrl         String?   @map("website_url") @db.VarChar(255)
  phoneNumber        String?   @map("phone_number") @db.VarChar(20)
  email              String?   @db.VarChar(100)
  address            String?   @db.VarChar(255)
  addressOverrideUrl String?   @map("address_override_url") @db.VarChar(500)
  contactName        String?   @map("contact_name") @db.VarChar(100)
  imageUrl           String?   @map("image_url") @db.VarChar(255)
  tagsText           String?   @map("tags_text")
  status             String?   @db.VarChar(20)
  submittedBy        Int       @map("submitted_by")
  reviewedBy         Int?      @map("reviewed_by")
  reviewNotes        String?   @map("review_notes")
  cardId             Int?      @map("card_id")
  createdDate        DateTime? @map("created_date") @db.Timestamp(6)
  reviewedDate       DateTime? @map("reviewed_date") @db.Timestamp(6)
  card               Card?     @relation(fields: [cardId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviewer           User?     @relation("SubmissionReviewer", fields: [reviewedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  submitter          User      @relation("SubmissionCreator", fields: [submittedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("card_submissions")
}

model CardModification {
  id                 Int       @id @default(autoincrement())
  cardId             Int       @map("card_id")
  name               String    @db.VarChar(255)
  description        String?
  websiteUrl         String?   @map("website_url") @db.VarChar(255)
  phoneNumber        String?   @map("phone_number") @db.VarChar(20)
  email              String?   @db.VarChar(100)
  address            String?   @db.VarChar(255)
  addressOverrideUrl String?   @map("address_override_url") @db.VarChar(500)
  contactName        String?   @map("contact_name") @db.VarChar(100)
  imageUrl           String?   @map("image_url") @db.VarChar(255)
  tagsText           String?   @map("tags_text")
  status             String?   @db.VarChar(20)
  submittedBy        Int       @map("submitted_by")
  reviewedBy         Int?      @map("reviewed_by")
  reviewNotes        String?   @map("review_notes")
  createdDate        DateTime? @map("created_date") @db.Timestamp(6)
  reviewedDate       DateTime? @map("reviewed_date") @db.Timestamp(6)
  card               Card      @relation(fields: [cardId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviewer           User?     @relation("ModificationReviewer", fields: [reviewedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  submitter          User      @relation("ModificationCreator", fields: [submittedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("card_modifications")
}

model ResourceCategory {
  id            Int            @id @default(autoincrement())
  name          String         @unique(map: "ix_resource_categories_name") @db.VarChar(100)
  displayOrder  Int?           @map("display_order")
  createdDate   DateTime?      @map("created_date") @db.Timestamp(6)
  resourceItems ResourceItem[]

  @@map("resource_categories")
}

model QuickAccessItem {
  id           Int       @id @default(autoincrement())
  identifier   String    @unique(map: "ix_quick_access_items_identifier") @db.VarChar(50)
  title        String    @db.VarChar(100)
  subtitle     String    @db.VarChar(100)
  phone        String    @db.VarChar(20)
  color        String    @db.VarChar(20)
  icon         String    @db.VarChar(50)
  displayOrder Int?      @map("display_order")
  isActive     Boolean?  @map("is_active")
  createdDate  DateTime? @map("created_date") @db.Timestamp(6)

  @@map("quick_access_items")
}

model ResourceItem {
  id           Int               @id @default(autoincrement())
  title        String            @db.VarChar(200)
  url          String            @db.VarChar(500)
  description  String
  category     String            @db.VarChar(100)
  categoryId   Int?              @map("category_id")
  phone        String?           @db.VarChar(20)
  address      String?           @db.VarChar(500)
  icon         String            @db.VarChar(50)
  displayOrder Int?              @map("display_order")
  isActive     Boolean?          @map("is_active")
  createdDate  DateTime?         @map("created_date") @db.Timestamp(6)
  updatedDate  DateTime?         @updatedAt @map("updated_date") @db.Timestamp(6)
  categoryObj  ResourceCategory? @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([category], map: "ix_resource_items_category")
  @@index([title], map: "ix_resource_items_title")
  @@map("resource_items")
}

model ResourceConfig {
  id          Int       @id @default(autoincrement())
  key         String    @unique(map: "ix_resource_config_key") @db.VarChar(100)
  value       String
  description String?   @db.VarChar(500)
  createdDate DateTime? @map("created_date") @db.Timestamp(6)
  updatedDate DateTime? @updatedAt @map("updated_date") @db.Timestamp(6)

  @@map("resource_config")
}

model Review {
  id             Int       @id @default(autoincrement())
  cardId         Int       @map("card_id")
  userId         Int       @map("user_id")
  rating         Int
  title          String?   @db.VarChar(200)
  comment        String?
  reported       Boolean?
  reportedBy     Int?      @map("reported_by")
  reportedDate   DateTime? @map("reported_date") @db.Timestamp(6)
  reportedReason String?   @map("reported_reason")
  hidden         Boolean?
  createdDate    DateTime? @map("created_date") @db.Timestamp(6)
  updatedDate    DateTime? @updatedAt @map("updated_date") @db.Timestamp(6)
  card           Card      @relation(fields: [cardId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reporter       User?     @relation("ReviewReporter", fields: [reportedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user           User      @relation("ReviewCreator", fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([cardId], map: "ix_reviews_card_id")
  @@index([createdDate], map: "ix_reviews_created_date")
  @@index([hidden], map: "ix_reviews_hidden")
  @@index([reported], map: "ix_reviews_reported")
  @@index([userId], map: "ix_reviews_user_id")
  @@map("reviews")
}

model ForumCategory {
  id               Int                    @id @default(autoincrement())
  name             String                 @unique(map: "ix_forum_categories_name") @db.VarChar(100)
  description      String?
  slug             String                 @unique(map: "ix_forum_categories_slug") @db.VarChar(120)
  displayOrder     Int?                   @map("display_order")
  isActive         Boolean?               @map("is_active")
  createdBy        Int                    @map("created_by")
  createdDate      DateTime?              @map("created_date") @db.Timestamp(6)
  updatedDate      DateTime?              @updatedAt @map("updated_date") @db.Timestamp(6)
  creator          User                   @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  categoryRequests ForumCategoryRequest[]
  threads          ForumThread[]

  @@map("forum_categories")
}

model ForumCategoryRequest {
  id            Int            @id @default(autoincrement())
  name          String         @db.VarChar(100)
  description   String?
  justification String?
  status        String?        @db.VarChar(20)
  requestedBy   Int            @map("requested_by")
  reviewedBy    Int?           @map("reviewed_by")
  createdDate   DateTime?      @map("created_date") @db.Timestamp(6)
  reviewedDate  DateTime?      @map("reviewed_date") @db.Timestamp(6)
  reviewNotes   String?        @map("review_notes")
  categoryId    Int?           @map("category_id")
  category      ForumCategory? @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  requester     User           @relation("CategoryRequester", fields: [requestedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviewer      User?          @relation("CategoryReviewer", fields: [reviewedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([status], map: "ix_forum_category_requests_status")
  @@map("forum_category_requests")
}

model ForumThread {
  id          Int           @id @default(autoincrement())
  categoryId  Int           @map("category_id")
  title       String        @db.VarChar(255)
  slug        String        @db.VarChar(280)
  isPinned    Boolean?      @map("is_pinned")
  isLocked    Boolean?      @map("is_locked")
  reportCount Int           @map("report_count")
  createdBy   Int           @map("created_by")
  createdDate DateTime?     @map("created_date") @db.Timestamp(6)
  updatedDate DateTime?     @updatedAt @map("updated_date") @db.Timestamp(6)
  posts       ForumPost[]
  reports     ForumReport[]
  category    ForumCategory @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  creator     User          @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([createdDate], map: "ix_forum_threads_created_date")
  @@index([slug], map: "ix_forum_threads_slug")
  @@index([title], map: "ix_forum_threads_title")
  @@index([updatedDate], map: "ix_forum_threads_updated_date")
  @@index([categoryId, isPinned, updatedDate], map: "ix_forum_threads_category_pinned_updated")
  @@map("forum_threads")
}

model ForumPost {
  id          Int           @id @default(autoincrement())
  threadId    Int           @map("thread_id")
  content     String
  isFirstPost Boolean?      @map("is_first_post")
  reportCount Int           @map("report_count")
  createdBy   Int           @map("created_by")
  createdDate DateTime?     @map("created_date") @db.Timestamp(6)
  updatedDate DateTime?     @updatedAt @map("updated_date") @db.Timestamp(6)
  editedBy    Int?          @map("edited_by")
  editedDate  DateTime?     @map("edited_date") @db.Timestamp(6)
  creator     User          @relation("PostCreator", fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  editor      User?         @relation("PostEditor", fields: [editedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  thread      ForumThread   @relation(fields: [threadId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reports     ForumReport[]

  @@index([threadId, createdDate], map: "ix_forum_posts_thread_created")
  @@index([createdBy], map: "ix_forum_posts_created_by")
  @@map("forum_posts")
}

model ForumReport {
  id              Int         @id @default(autoincrement())
  threadId        Int         @map("thread_id")
  postId          Int?        @map("post_id")
  reason          String      @db.VarChar(50)
  details         String?
  status          String?     @db.VarChar(20)
  reportedBy      Int         @map("reported_by")
  reviewedBy      Int?        @map("reviewed_by")
  createdDate     DateTime?   @map("created_date") @db.Timestamp(6)
  reviewedDate    DateTime?   @map("reviewed_date") @db.Timestamp(6)
  resolutionNotes String?     @map("resolution_notes")
  post            ForumPost?  @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reporter        User        @relation("ForumReporter", fields: [reportedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviewer        User?       @relation("ForumReviewedBy", fields: [reviewedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  thread          ForumThread @relation(fields: [threadId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("forum_reports")
}

model HelpWantedPost {
  id                Int                 @id @default(autoincrement())
  title             String              @db.VarChar(255)
  description       String
  category          String              @db.VarChar(50)
  status            String?             @db.VarChar(20)
  location          String?             @db.VarChar(255)
  budget            String?             @db.VarChar(100)
  contactPreference String?             @map("contact_preference") @db.VarChar(50)
  reportCount       Int                 @map("report_count")
  createdBy         Int                 @map("created_by")
  createdDate       DateTime?           @map("created_date") @db.Timestamp(6)
  updatedDate       DateTime?           @updatedAt @map("updated_date") @db.Timestamp(6)
  comments          HelpWantedComment[]
  creator           User                @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reports           HelpWantedReport[]

  @@index([category], map: "ix_help_wanted_posts_category")
  @@index([createdDate], map: "ix_help_wanted_posts_created_date")
  @@index([status], map: "ix_help_wanted_posts_status")
  @@index([title], map: "ix_help_wanted_posts_title")
  @@map("help_wanted_posts")
}

model HelpWantedComment {
  id          Int                 @id @default(autoincrement())
  postId      Int                 @map("post_id")
  content     String
  parentId    Int?                @map("parent_id")
  createdBy   Int                 @map("created_by")
  createdDate DateTime?           @map("created_date") @db.Timestamp(6)
  updatedDate DateTime?           @updatedAt @map("updated_date") @db.Timestamp(6)
  creator     User                @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  parent      HelpWantedComment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  replies     HelpWantedComment[] @relation("CommentReplies")
  post        HelpWantedPost      @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("help_wanted_comments")
}

model HelpWantedReport {
  id              Int            @id @default(autoincrement())
  postId          Int            @map("post_id")
  reason          String         @db.VarChar(50)
  details         String?
  status          String?        @db.VarChar(20)
  reportedBy      Int            @map("reported_by")
  reviewedBy      Int?           @map("reviewed_by")
  createdDate     DateTime?      @map("created_date") @db.Timestamp(6)
  reviewedDate    DateTime?      @map("reviewed_date") @db.Timestamp(6)
  resolutionNotes String?        @map("resolution_notes")
  post            HelpWantedPost @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reporter        User           @relation("HelpWantedReporter", fields: [reportedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviewer        User?          @relation("HelpWantedReviewer", fields: [reviewedBy], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("help_wanted_reports")
}

model SupportTicket {
  id                Int                    @id @default(autoincrement())
  title             String                 @db.VarChar(255)
  description       String
  category          String                 @db.VarChar(50)
  status            String                 @db.VarChar(20)
  priority          String                 @db.VarChar(20)
  isAnonymous       Boolean                @map("is_anonymous")
  createdBy         Int                    @map("created_by")
  assignedTo        Int?                   @map("assigned_to")
  createdDate       DateTime?              @map("created_date") @db.Timestamptz(6)
  updatedDate       DateTime?              @updatedAt @map("updated_date") @db.Timestamptz(6)
  resolvedDate      DateTime?              @map("resolved_date") @db.Timestamptz(6)
  closedDate        DateTime?              @map("closed_date") @db.Timestamptz(6)
  messages          SupportTicketMessage[]
  assignedSupporter User?                  @relation("TicketAssignee", fields: [assignedTo], references: [id], onDelete: NoAction, onUpdate: NoAction)
  creator           User                   @relation("TicketCreator", fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([category], map: "ix_support_tickets_category")
  @@index([createdDate], map: "ix_support_tickets_created_date")
  @@index([status], map: "ix_support_tickets_status")
  @@index([title], map: "ix_support_tickets_title")
  @@map("support_tickets")
}

model SupportTicketMessage {
  id             Int           @id @default(autoincrement())
  ticketId       Int           @map("ticket_id")
  content        String
  isInternalNote Boolean       @map("is_internal_note")
  createdBy      Int           @map("created_by")
  createdDate    DateTime?     @map("created_date") @db.Timestamptz(6)
  updatedDate    DateTime?     @updatedAt @map("updated_date") @db.Timestamptz(6)
  creator        User          @relation(fields: [createdBy], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ticket         SupportTicket @relation(fields: [ticketId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("support_ticket_messages")
}

model IndexingJob {
  id           Int       @id @default(autoincrement())
  resourceId   Int       @map("resource_id")
  status       String    @db.VarChar(20)
  pagesIndexed Int?      @map("pages_indexed")
  totalPages   Int?      @map("total_pages")
  lastError    String?   @map("last_error")
  startedAt    DateTime? @map("started_at") @db.Timestamptz(6)
  completedAt  DateTime? @map("completed_at") @db.Timestamptz(6)
  retryCount   Int?      @map("retry_count")
  createdDate  DateTime? @map("created_date") @db.Timestamptz(6)
  updatedDate  DateTime? @updatedAt @map("updated_date") @db.Timestamptz(6)

  @@index([resourceId], map: "ix_indexing_jobs_resource_id")
  @@index([status], map: "ix_indexing_jobs_status")
  @@map("indexing_jobs")
}

model TokenBlacklist {
  id        Int      @id @default(autoincrement())
  jti       String   @unique(map: "ix_token_blacklist_jti") @db.VarChar(36)
  tokenType String   @map("token_type") @db.VarChar(10)
  userId    Int?     @map("user_id")
  revokedAt DateTime @map("revoked_at") @db.Timestamp(6)
  expiresAt DateTime @map("expires_at") @db.Timestamp(6)
  user      User?    @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("token_blacklist")
}

model alembic_version {
  version_num String @id(map: "alembic_version_pkc") @db.VarChar(32)
}

model card_tags {
  card_id Int
  tag_id  Int
  cards   Card @relation(fields: [card_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tags    Tag  @relation(fields: [tag_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([card_id, tag_id])
  @@index([tag_id], map: "ix_card_tags_tag_id")
}

model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  token     String   @unique @db.VarChar(255)
  expiresAt DateTime @map("expires_at") @db.Timestamp(6)
  used      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  usedAt    DateTime? @map("used_at") @db.Timestamp(6)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token], map: "ix_password_reset_tokens_token")
  @@index([userId], map: "ix_password_reset_tokens_user_id")
  @@index([expiresAt], map: "ix_password_reset_tokens_expires_at")
  @@map("password_reset_tokens")
}
